
# 飞书移动端跟进记录列表页设计说明

## 一、页面概述

| 项目 | 说明 |
|:---|:---|
| **页面名称** | 跟进记录列表页 / 客户跟进历史详情页 |
| **目标平台** | 飞书移动端（iOS & Android） |
| **核心功能** | 展示客户-事项维度的跟进记录聚合，支持查看完整跟进历史 |
| **数据来源** | PostgreSQL `follow_records` 表 |

---

## 二、列表页设计（FollowRecordList）

### 2.1 页面布局

```
┌─────────────────────────────┐
│  ←  跟进记录          [+]   │  ← 导航栏
├─────────────────────────────┤
│ 🔍 搜索客户或事项...         │  ← 搜索栏（可选）
├─────────────────────────────┤
│                             │
│ ┌─────────────────────────┐ │
│ │ 阿里巴巴                │ │  ← 客户名称（customer_name）
│ │ 续约谈判                │ │  ← 事项（follow_content 摘要）
│ │ 2024-01-15              │ │  ← 最近跟进时间（仅年月日）
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ 腾讯科技                │ │
│ │ 新产品方案演示          │ │
│ │ 2024-01-14              │ │
│ └─────────────────────────┘ │
│                             │
│         ...                 │
│                             │
└─────────────────────────────┘
```

### 2.2 列表项（List Item）规范

| 元素 | 字段映射 | 样式说明 |
|:---|:---|:---|
| **主标题** | `customer_name` | 16px, 500字重, #1F2329（主文本色） |
| **副标题** | `follow_content` 前20字 | 14px, 400字重, #646A73（次要文本） |
| **时间** | `follow_time` 格式化日期 | 12px, #8F959E, 右对齐 |

### 2.3 时间显示规则（仅年月日）

| 时间范围 | 显示格式 |
|:---|:---|
| 当年 | "MM-DD"（如 01-15） |
| 往年 | "YYYY-MM-DD"（如 2023-12-01） |

### 2.4 数据聚合逻辑

列表按 **客户 + 事项** 维度聚合，显示该组合下**最近一次**跟进记录的时间：

```sql
-- 聚合查询：按客户+事项分组，取最近跟进时间
SELECT DISTINCT ON (customer_id, follow_content)
    id,
    customer_id,
    customer_name,
    follow_content,
    follow_time
FROM follow_records
WHERE user_id = $1
ORDER BY customer_id, follow_content, follow_time DESC;
```

---

## 三、详情页设计（FollowRecordTimeline）

### 3.1 页面布局

```
┌─────────────────────────────┐
│  ←  跟进历史                │  ← 导航栏
├─────────────────────────────┤
│                             │
│ ┌─────────────────────────┐ │
│ │      客户信息卡片        │ │
│ │  ┌─────┐ 阿里巴巴       │ │
│ │  │头像 │  续约谈判       │ │  ← 事项名称（当前分组key）
│ │  └─────┘  共3次跟进     │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │      时间轴区域          │ │
│ │                         │ │
│ │    ●────────────────    │ │
│ │    │ 2024-01-15        │ │
│ │    │ 14:30  面谈       │ │
│ │    │ ─────────────     │ │
│ │    │ 联系人：张三       │ │
│ │    │ 职务：采购经理     │ │
│ │    │                   │ │
│ │    │ 预期目标：         │ │
│ │    │ 完成年度续约       │ │
│ │    │                   │ │
│ │    │ 实际结果：         │ │
│ │    │ 客户基本同意方案   │ │
│ │    │ 需内部审批         │ │
│ │    │                   │ │
│ │    │ 存在风险：         │ │
│ │    │ 竞争对手低价介入   │ │
│ │    │                   │ │
│ │    │ 下一步计划：       │ │
│ │    │ 周三前发送正式报价 │ │
│ │    │                   │ │
│ │    ●────────────────    │ │
│ │    │ 2024-01-10        │ │
│ │    │ 10:00  电话       │ │
│ │    │ ─────────────     │ │
│ │    │ 联系人：李四       │ │
│ │    │ ...               │ │
│ │    │                   │ │
│ │    ●────────────────    │ │
│ │    │ 2024-01-05        │ │
│ │    │ 16:00  微信       │ │
│ │    │ ...               │ │
│ │                         │ │
│ └─────────────────────────┘ │
│                             │
│      [ + 添加跟进记录 ]      │  ← 底部固定按钮
│                             │
└─────────────────────────────┘
```

### 3.2 时间轴节点规范

| 元素 | 字段映射 | 样式说明 |
|:---|:---|:---|
| **时间轴节点** | - | 12px圆点，#3370FF（最新）/#8F959E（历史） |
| **连接线** | - | 2px实线，#DEE0E3 |
| **跟进时间** | `follow_time` | 14px, 500字重, #1F2329 |
| **具体时间** | `follow_time` | 12px, #8F959E |
| **跟进方式** | `follow_method` | 12px Tag标签（详情页内显示） |

### 3.3 时间轴卡片内容

每个时间节点展开显示完整字段：

| 显示名称 | 数据库字段 | 展示格式 |
|:---|:---|:---|
| 联系人 | `contact_person` | 14px, #1F2329 |
| 联系人职务 | `contact_role` | 12px, #646A73，与姓名同行 |
| 预期目标 | `follow_goal` | 14px, #1F2329，多行文本 |
| 实际结果 | `follow_result` | 14px, #1F2329，多行文本 |
| 存在风险 | `risk_content` | 14px, #FA5151（警示红），为空时隐藏整行 |
| 下一步计划 | `next_plan` | 14px, #1F2329，支持自动识别序号（1. 2. 3.） |

### 3.4 交互设计

| 操作 | 响应 |
|:---|:---|
| 点击时间节点 | 展开/收起该节点详情（默认展开最新一条） |
| 下拉刷新 | 重新加载该客户-事项的所有跟进记录 |

---

## 四、数据查询示例

### 4.1 列表页查询（聚合）

```sql
-- 获取客户-事项维度的聚合列表
WITH latest_records AS (
    SELECT DISTINCT ON (customer_id, LEFT(follow_content, 50))
        id,
        customer_id,
        customer_name,
        LEFT(follow_content, 50) as matter_summary,
        follow_time,
        ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY follow_time DESC) as rn
    FROM follow_records
    WHERE user_id = $1
    ORDER BY customer_id, LEFT(follow_content, 50), follow_time DESC
)
SELECT * FROM latest_records
ORDER BY follow_time DESC
LIMIT 20 OFFSET $2;
```

### 4.2 详情页查询（时间轴）

```sql
-- 获取指定客户-事项的所有跟进记录（时间轴）
SELECT 
    id,
    customer_name,
    contact_person,
    contact_role,
    contact_phone,
    follow_time,
    follow_method,
    follow_goal,
    follow_result,
    risk_content,
    next_plan,
    created_at
FROM follow_records
WHERE customer_id = $1 
  AND user_id = $2
  AND LEFT(follow_content, 50) = $3  -- 事项匹配
ORDER BY follow_time DESC;
```

---

## 五、关键状态处理

| 场景 | 处理方式 |
|:---|:---|
| 该客户-事项仅1条记录 | 时间轴显示单节点，隐藏"共X次跟进"或显示"共1次跟进" |
| 风险内容为空 | 该字段整行隐藏，不显示"无" |
| 联系人信息缺失 | 显示"未知联系人"，电话隐藏 |

---
